<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Машина Тюрінга</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tape { display: flex; justify-content: center; margin: 20px 0; }
    .cell { border: 1px solid black; padding: 10px; width: 30px; text-align: center; }
    .head { background: yellow; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; text-align: center; }
    .current { background: lightgreen; }
  </style>
</head>
<body>
  <h1>Машина Тюрінга</h1>

  <label>Початковий стан: <input id="state" value="1"></label>
  <br><br>

  <!-- ✅ Спочатку алфавіт -->
  <label>Алфавіт: <input id="alphabet" value="0,1,_"></label>
  <br><br>

  <!-- ✅ Потім слово -->
  <label>Вхідне слово: <input id="tapeInput" value="1011"></label>
  <br><br>

  <button onclick="init()">Ініціалізувати</button>
  <button onclick="nextStep()">Крок</button>

  <div class="tape" id="tape"></div>

  <h2>Правила</h2>
  <table id="rules">
    <tr>
      <th>Символ\Стан</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <td>0</td>
      <td>1 > 1</td>
      <td>0 < 1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0 > 2</td>
      <td>1 . 0</td>
    </tr>
    <tr>
      <td>_</td>
      <td>_ < 1</td>
      <td>_ . 0</td>
    </tr>
  </table>

  <script>
    let tape = [];
    let headPos = 0;
    let state = "1";
    let alphabet = [];

    function init() {
      // читаємо алфавіт
      alphabet = document.getElementById('alphabet').value.split(',');
      alphabet = alphabet.map(s => s.trim());

      // читаємо слово
      let input = document.getElementById('tapeInput').value;
      tape = input.split('');

      // додаємо пустий символ
      tape.push('_');
      headPos = 0;
      state = document.getElementById('state').value;
      renderTape();
    }

    function renderTape() {
      let tapeDiv = document.getElementById('tape');
      tapeDiv.innerHTML = '';
      for (let i = 0; i < tape.length; i++) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        if (i === headPos) cell.classList.add('head');
        cell.innerText = tape[i];
        tapeDiv.appendChild(cell);
      }
    }

    function nextStep() {
      let symbol = tape[headPos];
      let table = document.getElementById('rules');

      let rowIdx = Array.from(table.rows).findIndex(r => r.cells[0]?.innerText === symbol);
      let colIdx = Array.from(table.rows[0].cells).findIndex(c => c.innerText === state);

      if (rowIdx === -1 || colIdx === -1) {
        alert('Немає правила для цього стану!');
        return;
      }

      let cell = table.rows[rowIdx].cells[colIdx];
      let cmd = cell.innerText.trim();
      if (!cmd) { 
        alert('Немає правила для цього стану!'); 
        return; 
      }

      table.querySelectorAll('td').forEach(td => td.classList.remove('current'));
      cell.classList.add('current');

      let parts = cmd.split(/\s+/);
      if (parts.length !== 3) {
        alert('Команда повинна складатися з трьох частин: символ, напрямок (> < .), новий стан');
        return;
      }

      let [newSymbol, direction, newState] = parts;

      // ✅ перевірка на алфавіт
      if (!alphabet.includes(newSymbol)) {
        alert(`Символ "${newSymbol}" не входить у вказаний алфавіт!`);
        return;
      }

      tape[headPos] = newSymbol;

      if (direction === '.' && newState === '0') {
        alert('Машина зупинилась. Команда зупинки активована.');
        renderTape();
        return;
      }

      if (direction === '>' || direction === 'вправо') headPos++;
      else if (direction === '<' || direction === 'вліво') headPos--;
      else if (direction !== '.') {
        alert('Невірний напрямок. Використовуйте >, < або .');
        return;
      }

      state = newState;
      renderTape();
    }
  </script>
</body>
</html>

